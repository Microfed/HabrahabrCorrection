var Options={};Options.isLocalStorageEnable=function(){return(window.hasOwnProperty("localStorage")&&window.localStorage!==null)};Options.setLocalStorageItem=function(a,b){if(Options.isLocalStorageEnable()){localStorage.setItem(a,b)}};Options.getLocalStorageItem=function(a){if(Options.isLocalStorageEnable()){return localStorage.getItem(a)}else{return undefined}};Options.getTreeDiv=function(){return $("#errorTree")};Options.printNodeInfo=function(a){$("#activeTreeElement #title").val(a.data.title);$("#activeTreeElement #messageText").val(a.data.messageText);if(a.data.isFolder){$("#activeTreeElement #isFolder").attr("checked","checked")}$("#activeTreeElement").show()};Options.clearNodeInfo=function(){$("#activeTreeElement #title").empty();$("#activeTreeElement #messageText").empty();$("#activeTreeElement #isFolder").removeAttr("checked");$("#activeTreeElement").hide()};Options.printStatusMessage=function(a){$("#status").append(a);$("#status").show();setTimeout(function(){$("#status").effect("fade",500,function(){$("#status").empty()})},2000)};Options.save_options=function(){Options.setLocalStorageItem("isAdvtAttachToMessage",document.getElementById("isAdvtAttachToMessage").checked);Options.setLocalStorageItem("silentMode",document.getElementById("isSilentModeOn").checked);var a=Options.getTreeDiv().dynatree("getTree").toDict();Options.setLocalStorageItem("errorList",JSON.stringify(a.children));Options.printStatusMessage("Сохранено")};Options.setButtonUI=function(){$("button","#activeTreeElement").button()};Options.deleteActiveElement=function(){Options.getTreeDiv().dynatree("getActiveNode").remove();$("#activeTreeElement").show()};Options.acceptChangeActiveElement=function(){var b=Options.getTreeDiv().dynatree("getActiveNode"),d=$("#activeTreeElement #title").val(),c=$("#activeTreeElement #messageText").val(),a=$("input#isFolder").attr("checked")?true:false;console.log(a);if(!b){return}b.fromDict({title:d,messageText:c,isFolder:a})};Options.addNewElement=function(){var a,b=Options.getTreeDiv().dynatree("getRoot"),f=Options.getTreeDiv().dynatree("getActiveNode"),e=$("#activeTreeElement #title").val(),d=$("#activeTreeElement #messageText").val(),c=false;if(f!==null){if(f.data.isFolder){a=f}else{a=f.getParent()}}else{a=b;f=b}if(a===b&&!(f.data.isFolder)){c=($("#activeTreeElement #isFolder:checked").val()!==undefined)}a.addChild({title:e,messageText:d,isFolder:c})};Options.addButtonsToManageTree=function(){Options.setButtonUI();$("#delete","#activeTreeElement").click(Options.deleteActiveElement);$("#accept","#activeTreeElement").click(Options.acceptChangeActiveElement);$("#add","#activeTreeElement").click(Options.addNewElement)};Options.setTreeInfo=function(){var a=Options.getTreeDiv();if(a.text()!==""){a.dynatree("getTree").reload()}else{a.dynatree({onActivate:function(b){Options.printNodeInfo(b)},onDeactivate:function(){Options.clearNodeInfo()},children:JSON.parse(Options.getLocalStorageItem("errorList"))});Options.addButtonsToManageTree()}};Options.setErrorListFromFile=function(){$.getJSON(chrome.extension.getURL("/errorList.json"),function(a){Options.setLocalStorageItem("errorList",JSON.stringify(a));Options.setTreeInfo();Options.printStatusMessage("Список ошибок загружен")}).error(function(){Options.printStatusMessage("Проблема при загрузке файла. Список ошибок не обновлен.")})};Options.getBooleanValueFromString=function(b){var a=false;if(b==="true"){a=true}return a};Options.restore_options=function(){var b=Options.getLocalStorageItem("isAdvtAttachToMessage"),a=Options.getLocalStorageItem("silentMode");if(a===undefined){a="false";Options.setLocalStorageItem("silentMode",a)}document.getElementById("isAdvtAttachToMessage").checked=Options.getBooleanValueFromString(b);document.getElementById("isSilentModeOn").checked=Options.getBooleanValueFromString(a);if(Options.getLocalStorageItem("errorList")===undefined){Options.setErrorListFromFile()}Options.setTreeInfo()};