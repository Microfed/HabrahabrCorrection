$(function(){const i="http://habrahabr.ru/ajax/messages/add/";const l=".fn.nickname.url";const C=".fn.nickname.url.karmaloaded";const e="Слитное и раздельное написание";const z="Запятые";const o='<a href="http://therules.ru/';const j="habrahabr.ru";const p='\n\n<sub>Сделано с помощью <a href="https://chrome.google.com/webstore/detail/kcdmenmdkfpfbdilcpfehcnahhkjfipe">HabraCorrection</a>.</sub>';if(B()){F();k()}window.addEventListener("keydown",function(I){var H=I.ctrlKey||I.metaKey;if(H&&I.keyCode==13){A()}},false);function A(){if(B()){var J=document.baseURI;var H=d();var K='Ошибка в статье "'+a()+'"';var I=m(J);x();q(H,K,I);s(H,K)}}function v(H){var I=$(H).find("error");if(I[0]!=undefined){alert(I[0].textContent)}}function g(){var H;if(window.getSelection){H=window.getSelection().toString()}else{if(document.getSelection){H=document.getSelection()}else{if(document.selection){H=document.selection.createRange().text}}}return H}function a(){var H=$(".entry-title.single-entry-title span");if(H.text()==""){H=H.next()}return H.text()}function m(H){return'Ошибка в статье <a href="'+H+'">'+a()+"</a>\n<blockquote>"+g()+"</blockquote>"}function d(){var H;if($(l).length){H=$(l+" span").text()}else{H=$(C+" span").text()}return H}function B(){var I=false;var H=document.baseURI;if(H.search(j)!=-1){I=true}if(document.getElementById("comments")!==undefined){I=I&&true}else{I=false}return I}function c(I,H){$.post(H,I,function(J){v(J)})}function y(){return $("#type-of-error option:selected").val()}function D(){return $('<option value="4_1">Сложные и придаточные</option><option value="4_2">Главное и придаточное предложения</option><option value="4_3">Однородные члены предложения</option><option value="4_4">Повторяющиеся слова</option><option value="4_5">Cравнительные обороты</option><option value="4_6">Определительные обороты</option><option value="4_7">Обстоятельственные обороты</option><option value="4_8">Уточняющие слова</option><option value="4_9">Вводные слова</option><option value="4_10">Обращения</option><option value="4_11">Междометия</option><option value="4_12">Утвердительные, отрицательные и вопросительные слова</option>')}function f(){return $('<option value="5_1">Общие правила</option><option value="5_2">Существительные</option><option value="5_3">Прилагательные</option><option value="5_4">Числительные</option><option value="5_5">Наречия</option><option value="5_6">Предлоги, союзы, частицы, междометия</option><option value="5_7">Правописание не и ни</option>')}function G(I){var H="";switch(I){case"5_2":H="-nouns";break;case"5_3":H="-adjectives";break;case"5_4":H="-numerals";break;case"5_5":H="-adverbs";break;case"5_6":H="-prepositions";break;case"5_7":H="-particles";break}return H}function k(){$("body").append('<div id="dialog" title="Сообщение об ошибке" hidden><p id="dialog-author-name" style="font-family:verdana,sans-serif;font-size:11px;"></p><p id="dialog-message-title" style="font-family:verdana,sans-serif;font-size:11px;"><strong>Заголовок:</strong>&nbsp;</p><p style="font-family:verdana,sans-serif;font-size:11px;"><strong>Текст сообщения:</strong></p><textarea style="font-family:verdana,sans-serif;font-size:11px;" id="dialog-message-text" cols="65" rows="8" maxlength="1000" required></textarea><select id="type-of-error"><option value="1">Пропущен пробел</option><option value="2">Лишняя запятая</option><option value="3">Тся/ться</option><option value="4">Запятые</option><option value="5">Различное написание (слитное/дефис)</option></select></br><select id="subtype-of-error" style="width : 200px" hidden></select></div>');var H=$("#dialog-message-text");E(H);n(H)}function E(){$("#type-of-error").change(function(){var K=y();var J=$("#subtype-of-error");var H="";var I="\n";J.empty();switch(K){case"1":I+="Пропущен пробел.";break;case"2":I+="Лишняя запятая.";break;case"3":I+='<a href="http://tsya.ru">tsya.ru</a>';break;case"4":H=D();break;case"5":H=f();break}if(H.length>1){J.append(H);J.show()}w(I)})}function n(){$("#subtype-of-error").change(function(){var J="\n";var H="";var I=$("#subtype-of-error").val();if(I[0]=="4"){J+=o+"comma-"+I.substr(2)+'/">'+z+"</a>"}else{H=G(I);J+=o+"hyphen"+H+'/">'+e+"</a>"}w(J)})}function F(){$("head").append('<link type="text/css" href="'+chrome.extension.getURL("css/redmond/jquery-ui-1.8.16.custom.css")+'" rel="stylesheet" />')}function h(H){$("#dialog-author-name").append(H)}function u(H){$("#dialog-message-title").append(H)}function t(H){$("#dialog-message-text").val(H)}function q(H,J,I){h(H);u(J);t(I)}function s(H,I){$("#dialog").attr("hidden","true");$("#dialog").dialog({width:500},{height:360},{buttons:{"Опечатка!":function(){w("\nОпечатка!")},"Отправить":function(){var J=r(H,I);c(J,i);$(this).dialog("close")},"Отменить":function(){$(this).dialog("close")}}});$(".ui-dialog-buttonpane").find('button:contains("Опечатка!")').css("margin-right","180px")}function b(){return $("#dialog-message-text").val()+p}function w(I){var H=$("#dialog-message-text");H.text(H.val(H.val()+I))}function r(H,J){var I=b();return"message[recipients]="+encodeURIComponent(H)+"&message[title]="+encodeURIComponent(J)+"&message[text]="+encodeURIComponent(I)}function x(){$("#dialog-author-name").empty();$("#dialog-message-title").empty();$("#dialog-author-name").append("<strong>Кому:</strong>&nbsp;");$("#dialog-message-title").append("<strong>Заголовок:</strong>&nbsp;");$("#dialog-message-text").empty();$("#subtype-of-error").empty();$("#subtype-of-error").hide()}});