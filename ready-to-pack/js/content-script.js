$(function(){const i="http://habrahabr.ru/ajax/messages/add/";const l=".author";const D=".author.karmaloaded";const e="Слитное и раздельное написание";const A="Запятые";const o='<a href="http://therules.ru/';const j="habrahabr.ru";const p='\n\n<sub>Сделано с помощью <a href="https://chrome.google.com/webstore/detail/kcdmenmdkfpfbdilcpfehcnahhkjfipe">HabraCorrection</a>.</sub>';if(C()){G();k()}window.addEventListener("keydown",function(J){var I=J.ctrlKey||J.metaKey;if(I&&J.keyCode==13){B()}},false);function B(){if(C()){var K=document.baseURI;var I=d();var L='Ошибка в статье "'+a()+'"';var J=m(K);y();q(I,L,J);s(I,L)}}function w(I){var J=$(I).find("error");if(J[0]!=undefined){alert(J[0].textContent)}}function g(){var I;if(window.getSelection){I=window.getSelection().toString()}else{if(document.getSelection){I=document.getSelection()}else{if(document.selection){I=document.selection.createRange().text}}}return I}function a(){var I=$(".post .title");return I.text().replace(/^\s*|\s*$|[\t\n]/g,"")}function m(I){return'Ошибка в статье <a href="'+I+'">'+a()+"</a>\n<blockquote>"+g()+"</blockquote>"}function d(){var I;if($(l).length){I=$(l+" a").text()}else{I=$(D+" a").text()}return I}function C(){var J=false;var I=document.baseURI;if(I.search(j)!=-1){J=true}if(document.getElementById("comments")!==undefined){J=J&&true}else{J=false}return J}function c(J,I){$.post(I,J,function(K){w(K)})}function z(){return $("#type-of-error option:selected").val()}function E(){return $('<option value="4_1">Сложные и придаточные</option><option value="4_2">Главное и придаточное предложения</option><option value="4_3">Однородные члены предложения</option><option value="4_4">Повторяющиеся слова</option><option value="4_5">Cравнительные обороты</option><option value="4_6">Определительные обороты</option><option value="4_7">Обстоятельственные обороты</option><option value="4_8">Уточняющие слова</option><option value="4_9">Вводные слова</option><option value="4_10">Обращения</option><option value="4_11">Междометия</option><option value="4_12">Утвердительные, отрицательные и вопросительные слова</option>')}function f(){return $('<option value="5_1">Общие правила</option><option value="5_2">Существительные</option><option value="5_3">Прилагательные</option><option value="5_4">Числительные</option><option value="5_5">Наречия</option><option value="5_6">Предлоги, союзы, частицы, междометия</option><option value="5_7">Правописание не и ни</option>')}function H(J){var I="";switch(J){case"5_2":I="-nouns";break;case"5_3":I="-adjectives";break;case"5_4":I="-numerals";break;case"5_5":I="-adverbs";break;case"5_6":I="-prepositions";break;case"5_7":I="-particles";break}return I}function k(){$("body").append('<div id="habracorrect-dialog" title="Сообщение об ошибке" style="font-family:verdana,sans-serif;font-size:12px;text-align:left" hidden><p id="dialog-author-name"></p><p id="dialog-message-title"><b>Заголовок:</b>&nbsp;</p><p><b>Текст сообщения:</b></p><textarea id="dialog-message-text" cols="60" rows="8" maxlength="1000" required></textarea><select id="type-of-error"><option value="1">Пропущен пробел</option><option value="2">Лишняя запятая</option><option value="3">Тся/ться</option><option value="4">Запятые</option><option value="5">Различное написание (слитное/дефис)</option></select></br><select id="subtype-of-error" style="width : 200px" hidden></select></div>');F();n()}function F(){$("#type-of-error").change(function(){var L=z();var K=$("#subtype-of-error");var I="";var J="\n";K.empty();switch(L){case"1":J+="Пропущен пробел.";break;case"2":J+="Лишняя запятая.";break;case"3":J+='<a href="http://tsya.ru">tsya.ru</a>';break;case"4":I=E();break;case"5":I=f();break}if(I.length>1){K.append(I);K.show()}x(J)})}function n(){$("#subtype-of-error").change(function(){var K="\n";var I="";var J=$("#subtype-of-error").val();if(J[0]=="4"){K+=o+"comma-"+J.substr(2)+'/">'+A+"</a>"}else{I=H(J);K+=o+"hyphen"+I+'/">'+e+"</a>"}x(K)})}function G(){$("head").append('<link type="text/css" href="'+chrome.extension.getURL("css/redmond/jquery-ui-1.8.16.custom.css")+'" rel="stylesheet" />')}function h(I){$("#dialog-author-name").append(I)}function v(I){$("#dialog-message-title").append(I)}function u(I){$("#dialog-message-text").val(I)}function q(I,K,J){h(I);v(K);u(J)}function t(I,K,J){chrome.extension.sendRequest({to_send_data:true,send_author:I,send_title:K,send_text:J},function(L){c(L.send_data,i)})}function s(I,J){$("#habracorrect-dialog").attr("hidden","true");$("#habracorrect-dialog").dialog({width:500},{height:360},{buttons:{"Опечатка!":function(){x("\nОпечатка!")},"Отправить":function(){t(I,J,b());$(this).dialog("close")},"Отменить":function(){$(this).dialog("close")}}});$(".ui-dialog-buttonpane").find('button:contains("Опечатка!")').css("margin-right","180px")}function b(){return $("#dialog-message-text").val()}function x(J){var I=$("#dialog-message-text");I.text(I.val(I.val()+J))}function r(I,K){var J=b();return"message[recipients]="+encodeURIComponent(I)+"&message[title]="+encodeURIComponent(K)+"&message[text]="+encodeURIComponent(J)}function y(){$("#dialog-author-name").empty();$("#dialog-message-title").empty();$("#dialog-author-name").append("<b>Кому:</b>&nbsp;");$("#dialog-message-title").append("<b>Заголовок:</b>&nbsp;");$("#dialog-message-text").empty();$("#subtype-of-error").empty();$("#subtype-of-error").hide()}});